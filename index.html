<!DOCTYPE html>
    <meta charset="utf-8">
    <meta name="description" content="Nos amis les koalas">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, width=890, minimal-ui">
    <link rel="icon" href="./img/favicon.ico">
    <title>Koalas</title>
    <script src="./assets/js/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="./assets/js/typed.js" type="text/javascript"></script>
    <script src="./assets/js/background-blur.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="./assets/css/main.css" />
    <body >
		<img id="background" style="position: fixed; left: 0; top: 0; width: 100%; height: 100%"></img>
        <div id="content">
        </div>
    </body>
    <script>
        var fade = false;
        var startup = "";

        function render(tag) {
            // Render background
            var panel = data[tag];
            if (fade) {
                $("body").fadeTo('slow', 0, function() {
                    $("#background").attr("src", panel.background.content);
                }).fadeTo("slow", 1, function() {
                    $("#content").fadeTo('slow', 1);
                });
            } else {
                $("#background").attr("src", panel.background.content);
            }


            // Render elements

            // Flush previous elements
            $("#content").html("");

            panel.elements.forEach(function(element) {
                switch(element.type) {
                    case "Text":
                        var div = $("<div></div>");
                        if (element.content) { div.text(element.content)}
                        div.css("position", "absolute");
                        div.css("width", "100%");
                        div.css("height", "100%");
                        if ("positionX" in element) { div.css("left", element.positionX) }
                        if ("positionY" in element) { div.css("top", element.positionY) }
                        if ("width" in element) { div.css("width", element.width) }
                        if ("height" in element) { div.css("height", element.height) }
                        if ("classes" in element) { div.addClass(element.classes) }
                        if ("ids" in element) { div.attr("id", element.ids) }
                        if ("styles" in element) { div.css(styles) }
                        if ("size" in element) { div.css("font-size", element.size) }
                        if ("alignment" in element) { div.css("text-align", "center") }
                        $("#content").append(div);
                        break;
                    case "Image":
                        var div = $("<img></img>");
                        div.css("position", "absolute");
                        div.attr("src", element.src);
                        if ("positionX" in element) { div.css("left", element.positionX) }
                        if ("positionY" in element) { div.css("top", element.positionY) }
                        div.attr("height", element.height)
                        div.attr("width", element.width)
                        if ("classes" in element) { div.addClass(element.classes) }
                        if ("ids" in element) { div.attr("id", element.ids) }
                        if ("styles" in element) { div.css(styles) }
                        $("#content").append(div);
                        break;
                    case "Button":
                        var div = $("<div class='btn'></div>").text(element.content);

                        div.css("position", "absolute");
                        div.attr("src", element.src);
                        if ("positionX" in element) { div.css("left", element.positionX) }
                        if ("positionY" in element) { div.css("top", element.positionY) }
                        div.css("height", element.height)
                        div.css("width", element.width)
                        if ("classes" in element) { div.addClass(element.classes) }
                        if ("ids" in element) { div.attr("id", element.ids) }
                        if ("size" in element) { div.css("font-size", element.size) }
                        if ("styles" in element) { div.css(styles) }
                        var target = element.target;
                        var fn = function() { render(target.content) };
                        if ("effect" in target && target.effect == "fade") {
                            fn = function() {
								fade = true
                                $("#content").css("opacity", 0);
								render(target.content);
								fade = false;
                            }
                        }

                        switch (target.type) {
                            case "Simple":
                                div.click(fn);
                        }

                        $("#content").append(div);
                        break;
                    case "Custom":
                        element.fn();
                        break;

                }
            });
        }

        data={ "input-startup": { "background": { "content": "img/espace-terre.png" },
                          "elements": [
                            { type: "Text", alignment: "center", ids: "typed", content: "Ta Startup", positionX: "38%", positionY: "23%", width: "24%", height: "10%", classes: "question" },
                            { type: "Button", id :"btn", content: "Soumettre", positionX: "45%", positionY: "71%", width: "10%", height: "30px", size: "18pt", target: {type: "Simple", content: "plan-1", effect: "fade" } },
                            {type: "Custom", fn: function() {
                                var inpt = "<input id='name' type='text', class='startup-input' />";
                                $("#content").append(inpt);
                                $("#btn").click(function() {
                                    startup = $("#name").val();
                                    fade = true
									$("#content").text("");
                                    render("plan-1");
                                    $("body").fadeTo('slow', 1);
                                    fade = false;
                                });
                                                            } }
                            ]
                        },
                "plan-1": {
                    "background": { "content": "img/Planetes.png" },
                    "elements": []
                        // goto choice 1
                },
                "choice-1": {
                    "background": { "content": "img/espace-terre.png" },
                    "elements": [
                        { type: "Text", alignment: "center", content: "Partenaires ?", positionX: "38%", positionY: "15%", width: "24%", height: "10%", classes: "question" },
                        { type: "Button", content: "Choix 1", positionX: "20%", positionY: "71%", width: "20%", height: "30px", size: "16pt", target: {type: "Simple", content: "plan-2", effect: "fade" } },
                        { type: "Button", content: "Choix 2", positionX: "60%", positionY: "71%", width: "20%", height: "30px", size: "16pt", target: {type: "Simple", content: "plan-3", effect: "fade" } },
                    ]
                },
                "plan-2": {
                    "background": { "content": "img/Planetes.png" },
                    "elements": []
                        // goto choice 2
                },
                "plan-3": {
                    "background": { "content": "img/Planetes.png" },
                    "elements": []
                        // goto choice 3
                },
                "choice-3": {
                    "background": { "content": "img/espace-terre.png" },
                    "elements": [
                        { type: "Text", alignment: "center", content: "I & R\nLabellisation", positionX: "38%", positionY: "15%", width: "24%", height: "15%", classes: "question" },
                        { type: "Image", ids:"ch1", classes: "airship", src: "./img/fusee.gif", positionX: "20%", positionY: "53%", width: "10%", height: "20%"},
                        { type: "Image", ids:"ch2", classes: "airship", src: "./img/fusee.gif", positionX: "45%", positionY: "53%", width: "10%", height: "20%"},
                        { type: "Image", ids:"ch3", classes: "airship", src: "./img/fusee.gif", positionX: "70%", positionY: "53%", width: "10%", height: "20%"},
                        { type: "Custom", fn: function() {
                                // WINNER IS NUMBER 2
                                $("#ch1").click(function() {
                                    fade = true
                                    $("#content").text("");
                                    render("plan-4");
                                    $("body").fadeTo('slow', 1);
                                    fade = false;
                                });
                                $("#ch2").click(function() {
                                    fade = true
                                    $("#content").text("");
                                    render("plan-5");
                                    $("body").fadeTo('slow', 1);
                                    fade = false;
                                });
                                $("#ch3").click(function() {
                                    fade = true
                                    $("#content").text("");
                                    render("plan-4");
                                    $("body").fadeTo('slow', 1);
                                    fade = false;
                                });
                                                         } }


                    ]
                },
                "plan-4": {
                    "background": { "content": "img/Planetes.png" },
                    "elements": []
                        // goto choice 4
                },
                "plan-5": {
                    "background": { "content": "img/Planetes.png" },
                    "elements": []
                        // goto choice 5
                },
                "choice-2": {
                    "background": {content: "img/espace-terre.png" },
                    "elements": [
                        { type: "Image", src: "./img/dummy-hist.png", positionX: "30%", positionY: "30%", width: "40%", height: "35%"  },
                        { type: "Button", id :"btn", content: "Suivant", positionX: "45%", positionY: "71%", width: "10%", height: "30px", size: "18pt", target: {type: "Simple", content: "choice-3", effect: "fade" } },
                    ]
                },
                "choice-4": {
                    "background": {content: "img/espace-terre.png" },
                    "elements": [
                        { type: "Text", content: "Explication Echec", classes: "question", positionX: "38%", positionY: "30%", width: "26%", height: "10%" },
                        { type: "Button", id :"btn", content: "Suivant", positionX: "45%", positionY: "71%", width: "10%", height: "30px", size: "18pt", target: {type: "Simple", content: "choice-3", effect: "fade" } },
                    ]
                },
                "choice-5": {
                    "background": { content: "img/espace-terre.png" },
                    "elements": [
                        { type: "Text", alignment: "center", content: "Financements", positionX: "35%", positionY: "10%", width: "30%", height: "10%", classes: "question"},
                        { type: "Text", ids: "btn1", content: "", positionX: "29%", positionY: "35%", classes: "input-checkbox" },
                        { type: "Text", ids: "btn2", content: "", positionX: "49%", positionY: "35%", classes: "input-checkbox" },
                        { type: "Text", ids: "btn3", content: "", positionX: "68%", positionY: "35%", classes: "input-checkbox" },
                        { type: "Text", ids: "btn4", content: "", positionX: "29%", positionY: "45%", classes: "input-checkbox" },
                        { type: "Text", ids: "btn5", content: "", positionX: "49%", positionY: "45%", classes: "input-checkbox" },
                        { type: "Text", ids: "btn6", content: "", positionX: "68%", positionY: "45%", classes: "input-checkbox" },
                        { type: "Text", ids: "btn7", content: "", positionX: "29%", positionY: "55%", classes: "input-checkbox" },
                        { type: "Text", ids: "btn8", content: "", positionX: "49%", positionY: "55%", classes: "input-checkbox" },
                        { type: "Text", ids: "btn9", content: "", positionX: "68%", positionY: "55%", classes: "input-checkbox" },
                        { type: "Button", ids :"btnGo", content: "Soumettre", positionX: "45%", positionY: "71%", width: "10%", height: "30px", size: "18pt", target: {type: "Simple", content: "", effect: "fade" } },
                        { type: "Custom", fn: function() {
                            $("#btn1").click(function() { $("#btn1").toggleClass("active") });
                            $("#btn2").click(function() { $("#btn2").toggleClass("active") });
                            $("#btn3").click(function() { $("#btn3").toggleClass("active") });
                            $("#btn4").click(function() { $("#btn4").toggleClass("active") });
                            $("#btn5").click(function() { $("#btn5").toggleClass("active") });
                            $("#btn6").click(function() { $("#btn6").toggleClass("active") });
                            $("#btn7").click(function() { $("#btn7").toggleClass("active") });
                            $("#btn8").click(function() { $("#btn8").toggleClass("active") });
                            $("#btn9").click(function() { $("#btn9").toggleClass("active") });

                            // CHANGE THE COMBINATION
                            $("#btnGo").unbind("click");
                            $("#btnGo").click(function() {
                                var expected = [true, true, true, false, false, false, undefined, undefined, undefined];
                                var gotten = [false, false, false, false, false, false, false, false, false];
                                if ($("#btn1").attr("class").split(' ').indexOf("active") != -1) { gotten[0] = true; }
                                if ($("#btn2").attr("class").split(' ').indexOf("active") != -1) { gotten[1] = true; }
                                if ($("#btn3").attr("class").split(' ').indexOf("active") != -1) { gotten[2] = true; }
                                if ($("#btn4").attr("class").split(' ').indexOf("active") != -1) { gotten[3] = true; }
                                if ($("#btn5").attr("class").split(' ').indexOf("active") != -1) { gotten[4] = true; }
                                if ($("#btn6").attr("class").split(' ').indexOf("active") != -1) { gotten[5] = true; }
                                if ($("#btn7").attr("class").split(' ').indexOf("active") != -1) { gotten[6] = true; }
                                if ($("#btn8").attr("class").split(' ').indexOf("active") != -1) { gotten[7] = true; }
                                if ($("#btn9").attr("class").split(' ').indexOf("active") != -1) { gotten[8] = true; }

                                var target = "choice-5-ko";

                                if (checkResult(gotten, expected)) { target = "choice-5-ok" }
                                fade = true
                                $("#content").css("opacity", 0);
                                render(target);
                                fade = false;
                             });
                                                         }}

                    ]
                },
                "choice-5-ko": {
                    "background": {content: "img/espace-terre.png" },
                    "elements": [
                        { type: "Text", content: "Explication Echec", classes: "question", positionX: "38%", positionY: "30%", width: "26%", height: "10%" },
                        { type: "Button", id :"btn", content: "Suivant", positionX: "45%", positionY: "71%", width: "10%", height: "30px", size: "18pt", target: {type: "Simple", content: "choice-5", effect: "fade" } },
                    ]
                },
                "choice-5-ok": {
                    "background": {content: "img/espace-terre.png" },
                    "elements": [
                        { type: "Text", content: "Explication Reussite", classes: "question", positionX: "38%", positionY: "30%", width: "26%", height: "10%" },
                        { type: "Button", id :"btn", content: "Suivant", positionX: "45%", positionY: "71%", width: "10%", height: "30px", size: "18pt", target: {type: "Simple", content: "plan-6", effect: "fade" } },
                    ]
                },
                "plan-6": {
                    "background": { "content": "img/Planetes.png" },
                    "elements": []
                        // goto choice 6
                },
                "choice-6": {
                    "background": { "content": "img/espace-terre.png" },
                    "elements": [
                        { type: "Text", alignment: "center", content: "Orientation", positionX: "38%", positionY: "15%", width: "24%", height: "10%", classes: "question" },
                        { type: "Button", content: "Sciences", positionX: "20%", positionY: "71%", width: "20%", height: "30px", size: "18pt", target: {type: "Simple", content: "sciences", effect: "fade" } },
                        { type: "Button", content: "Eco", positionX: "60%", positionY: "71%", width: "20%", height: "30px", size: "18pt", target: {type: "Simple", content: "eco", effect: "fade" } },
                    ]
                },
                "sciences": {
                    "background": {content: "img/espace-terre.png" },
                    "elements": [
                        { type: "Text", content: "Sciences", classes: "question", positionX: "38%", positionY: "30%", width: "26%", height: "10%" },
                        { type: "Button", id :"btn", content: "Suivant", positionX: "45%", positionY: "71%", width: "10%", height: "30px", size: "18pt", target: {type: "Simple", content: "congrats", effect: "fade" } },
                    ]
                },
                "eco": {
                    "background": {content: "img/espace-terre.png" },
                    "elements": [
                        { type: "Text", content: "Eco", classes: "question", positionX: "38%", positionY: "30%", width: "26%", height: "10%" },
                        { type: "Button", id :"btn", content: "Suivant", positionX: "45%", positionY: "71%", width: "10%", height: "30px", size: "18pt", target: {type: "Simple", content: "congrats", effect: "fade" } },
                    ]
                },
                "congrats": {
                    "background": {content: "img/espace-terre.png" },
                    "elements": [
                        { type: "Text", content: "Félicitations", classes: "question", positionX: "38%", positionY: "30%", width: "26%", height: "10%" },
                        { type: "Button", id :"btn", content: "Suivant", positionX: "45%", positionY: "71%", width: "10%", height: "30px", size: "18pt", target: {type: "Simple", content: "exit", effect: "fade" } },
                    ]
                },
            };

        $(function() {
            render("input-startup");
        });

        function checkResult(received, expected) {
            var acc = true;
            for (i = 0; i < received.length; i++) {
                if (expected[i] != undefined) {
                    acc = acc && (received[i] == expected[i]);
                }
            }
            return acc;

        }

    </script>
</html>
